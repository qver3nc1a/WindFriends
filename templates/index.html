{% extends "base.html" %}
{% block content %}
    <div class="centered-app">
    <h1>WindFriends</h1>
    {% if error %}
        <p class="error">{{ error }}</p>
    {% endif %}
    {% if register_success %}
        <p class="success">Registered successfully! You can now log in below:</p>
    {% endif %}
    {% if session.username %}
    <p>
        Signed in as <a href="/user/{{ session.user_id }}">{{ session.username }}</a>
    </p>
    <form action="/logout" method="post">
        <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
        <button type="submit">Logout</button>
    </form>
    <div>
        <h2>Meetings</h2>
        {% if show_all_meetings_header %}
            <p>You can view and suggest meetings now! Welcome!</p>
        {% else %}
            <p>Most recent meetings</p>
        {% endif %}
        {% if meetings|length == 0 %}
            <p>No meetings yet</p>
        {% else %}
            <div class="meeting-list">
                {% for meeting in meetings %}
                <div class="meeting-card">
                    <div>
                        <a href="/meeting/{{ meeting.id }}">{{ meeting.title }}</a><br />
                        <span class="meeting-date">{{ meeting.date|finnish_datetime}} by <a href="/user/{{ meeting.user_id }}">{{ meeting.username }}</a></span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% if page and page_count %}
            <div class="pager">
                {% if page > 1 %}
                    <a class="pager-link" href="/1" title="First page">««</a>
                    <a class="pager-link" href="/{{ page - 1 }}" title="Previous page">«</a>
                {% else %}
                    <span class="pager-disabled">««</span>
                    <span class="pager-disabled">«</span>
                {% endif %}

                <span class="pager-status">Page {{ page }} / {{ page_count }}</span>

                {% if page < page_count %}
                    <a class="pager-link" href="/{{ page + 1 }}" title="Next page">»</a>
                    <a class="pager-link" href="/{{ page_count }}" title="Last page">»»</a>
                {% else %}
                    <span class="pager-disabled">»</span>
                    <span class="pager-disabled">»»</span>
                {% endif %}
            </div>
            {% endif %}
        {% endif %}
    </div>

    {% else %}
    <h3>Welcome to WindFriends! View and suggest meetings, meet new people. </h3>
    <h3>Which gear do you prefer? What's your favorite weather to surf? Let's enjoy the wind together!</h3>
    <p>
        Log in below to view and suggest meetings
    </p>

    <form action="/login" method="post">
        <p>
        <label for="login_username">Username</label><br />
        <input id="login_username" type="text" name="username"/>
        </p>
        <p>
        <label for="login_password">Password</label><br />
        <input id="login_password" type="password" name="password"/>
        </p>
        <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
        <input type="submit" value="Login" />
    </form>
    <p>If you don't have an account yet, register below</p>
    <form action="/register" method="get">
        <button type="submit">Register</button>
    </form>
    {% endif %}
    </div>
{% endblock %}
