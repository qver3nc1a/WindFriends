{% extends "base.html" %}
{% block content %}
    <div class="centered-app">
    <h1>{{ meeting.titleÂ }}</h1>
    <div class="meeting-field">
        <span class="meeting_headers_h3">Gear:</span>
        <span>{{ meeting.gear }}</span>
    </div>
    <div class="meeting-field">
    <span class="meeting_headers_h3">Date:</span>
    <span>{{ meeting.date|finnish_datetime }}</span>
    </div>
    <div class="meeting-field">
        <span class="meeting_headers_h3">Additional information:</span>
        <span>{{ meeting.description | replace('\n', '<br>') | safe }}</span>
    </div>
    <div class="meeting-field">
        <span class="meeting_headers_h3">Organizer:</span>
        <span><a href="/user/{{ meeting.user_id }}">{{ meeting.username }}</a></span>
    </div>
    {% if meeting.tags %}
    <div class="meeting-field">
        <span class="meeting_headers_h3">Tags:</span>
        <span>
            {% for t in meeting.tags.split(',') %}
                {% if t.strip() %}
                <span class="tag">{{ t.strip() }}</span>
                {% endif %}
            {% endfor %}
        </span>
    </div>
    {% endif %}
    {% if session.user_id == meeting.user_id %}
        <form action="/edit_meeting/{{ meeting.id }}" method="post">
            <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
            <button type="submit">Edit</button>
        </form>
        <br>
        <form action="/delete_meeting/{{ meeting.id }}" method="post">
            <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
            <button type="submit">Delete</button>
        </form>
    {%endif%}
    <hr>
    <div class="chat-section">
        <h3>Ask the organizer a question</h3>
            <div class="chat-messages">
                {% if messages %}
                    {% for msg in messages %}
                        <div class="chat-message">
                            <strong>{{ msg.username }}</strong> <span class="chat-date">({{ msg.created_at }})</span><br>
                            {{ msg.content }}
                        </div>
                    {% endfor %}
                {% else %}
                    <p>No questions yet. Be the first to ask!</p>
                {% endif %}
            </div>
            {% if error %}
                <p class="error">{{ error }}</p>
            {% endif %}
            {% if session.user_id %}
            <form action="/meeting/{{ meeting.id }}/message" method="post">
                <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
                <textarea name="content" rows="2" cols="40" placeholder="Type your question here..."></textarea><br>
                <button class="message-button" type="submit">Send</button>
            </form>
            {% else %}
            <p><a href="/login">Log in</a> to ask a question.</p>
            {% endif %}
        </div>
    </div>
{% endblock %}